-- Atin PS with X2ZU UI (Auto ON + On/Off Tabs)
-- Load X2ZU UI Library
local Library = loadstring(game:HttpGet("https://raw.githubusercontent.com/x2zu/OPEN-SOURCE-UI-ROBLOX/refs/heads/main/X2ZU%20UI%20ROBLOX%20OPEN%20SOURCE/DummyUi-leak-by-x2zu/fetching-main/Tools/Framework.luau"))()

-- Window
local Window = Library:Window({Title = "AtinPS", SubTitle = "Auto Rejoin + AutoExec"})

-- Tabs
local TabOn  = Window:Tab({Title = "On", Icon = "check"})
local TabOff = Window:Tab({Title = "Off", Icon = "x"})

-- ====== CONFIG ======
local PRIVATE_PLACE_ID = 123224294054165
local AUTO_URL         = "https://raw.githubusercontent.com/LlyXCode-gif/LlyXCode/refs/heads/main/AtinVIP"
local OFFSET_Y         = 0
local DELAY            = 1
local REPEAT_26        = 1
local REPEAT_PUNC      = 1
local ASK_DELAY        = 1

local POS_CP26   = Vector3.new(625.56, 1799.20, 3432.68)
local POS_PUNCAK = Vector3.new(782.69, 2155.87, 3915.90)

-- ====== SERVICES ======
local Players         = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local player          = Players.LocalPlayer
repeat task.wait() until game:IsLoaded()

-- ====== HELPERS ======
local function hrp()
    local c = player.Character or player.CharacterAdded:Wait()
    return c:WaitForChild("HumanoidRootPart")
end

local function zeroVelocities(char)
    for _, v in ipairs(char:GetDescendants()) do
        if v:IsA("BasePart") then
            v.AssemblyLinearVelocity  = Vector3.new(0,0,0)
            v.AssemblyAngularVelocity = Vector3.new(0,0,0)
        end
    end
end

local function tpInstant(pos)
    local c = player.Character or player.CharacterAdded:Wait()
    zeroVelocities(c)
    hrp().CFrame = CFrame.new(pos + Vector3.new(0, OFFSET_Y, 0))
end

local function queueAuto(url)
    local q = queue_on_teleport
        or (syn and syn.queue_on_teleport)
        or (fluxus and fluxus.queue_on_teleport)
        or (KRNL_LOADED and queue_on_teleport)
        or (getgenv and getgenv().queue_on_teleport)
    if q and type(q) == "function" and url and url ~= "" then
        q(('loadstring(game:HttpGet("%s"))()'):format(url))
    end
end

-- ====== STATE ======
local running = false
local stopFlag = false

local function runAuto()
    running = true
    stopFlag = false

    -- CP26
    for i=1, REPEAT_26 do
        if stopFlag then return end
        tpInstant(POS_CP26)
        task.wait(DELAY)
    end

    -- Puncak
    for i=1, REPEAT_PUNC do
        if stopFlag then return end
        tpInstant(POS_PUNCAK)
        task.wait(DELAY)
    end

    -- Auto-exec
    queueAuto(AUTO_URL)

    -- Rejoin
    task.wait(ASK_DELAY)
    if stopFlag then return end

    local ok, err = pcall(function()
        local jd = player:GetJoinData()
        local td = jd and jd.TeleportData
        local code = td and td.reservedCode

        if code and code ~= "" then
            local opts = Instance.new("TeleportOptions")
            opts:SetTeleportData({ reservedCode = code, via = "RzMods-Client" })
            TeleportService:TeleportToPrivateServer(PRIVATE_PLACE_ID, code, {player}, nil, opts)
        else
            TeleportService:Teleport(PRIVATE_PLACE_ID, player)
        end
    end)

    if not ok then
        warn("[RzMods][Rejoin] gagal:", err)
        pcall(function() TeleportService:Teleport(PRIVATE_PLACE_ID, player) end)
    end
end

-- ====== UI Buttons ======
TabOn:Button({
    Title = "Start Auto",
    Callback = function()
        if not running then
            task.spawn(runAuto)
        end
    end
})

TabOff:Button({
    Title = "Stop Auto",
    Callback = function()
        stopFlag = true
        running = false
        Library:Notification({Title = "AtinPS", Content = "Auto stopped"})
    end
})

-- ====== AUTO START ======
task.spawn(runAuto)
